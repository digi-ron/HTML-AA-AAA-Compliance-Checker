<html>
    <head>
        <title>Style Guide</title>
        <script>
            //global variables

            //function definitions
            function submitForm(complianceLevel = "AA") {
                console.log('Compliance Level: ' + complianceLevel);
                const form = document.getElementById('mainform-hexCode');
                if (!form.checkValidity()) {
                    alert('Please enter a valid hex color code.');
                    return;
                }
                const colorCode = document.getElementById('inputCode').value.toUpperCase();
                console.log('Color Code: ' + colorCode);
                setColorAndText(colorCode, 'selectedColor');
                const compatibleColors = calculateCompatibleColors(colorCode, complianceLevel);
                displayResults(compatibleColors);
            }

            function setColorAndText(colorCode, elementId) {
                var innerElement = document.createElement('div');
                createColorComparisonText(colorCode, 'white', innerElement);
                createColorComparisonText(colorCode, 'lightgrey', innerElement);
                createColorComparisonText(colorCode, 'darkgrey', innerElement);
                createColorComparisonText(colorCode, 'black', innerElement);
                innerElement.style.backgroundColor = '#' + colorCode;
                const colorDiv = document.getElementById(elementId);
                colorDiv.innerHTML = '';
                colorDiv.appendChild(innerElement);
            }

            function createColorComparisonText(innerText, color, parent = null) {
                var p = document.createElement('p');
                p.innerText = innerText;
                p.style.color = color;
                if (parent) {
                    parent.appendChild(p);
                }
                return p;
            }

            function calculateCompatibleColors(colorCode, complianceLevel) {
                const inputLuminance = calculateLuminance(colorCode) + 0.05;
                //big loop
                const compatibleColors = [];
                for(var r = 0; r < 256; r++) {
                    for(var g = 0; g < 256; g++) {
                        for(var b = 0; b < 256; b++) {
                            const newColorCode = numberToHex(r) + numberToHex(g) + numberToHex(b);
                            const newLuminance = calculateLuminance(newColorCode) + 0.05;
                            const ratio = inputLuminance < newLuminance ? newLuminance / inputLuminance : inputLuminance / newLuminance;
                            const newColor = {colorCode: newColorCode, luminance: newLuminance, ratio: ratio, AA: false, AALarge: false, AAA: false, AAALarge: false};
                            newColor.AA = ratio > 4.5;
                            newColor.AALarge = ratio > 3;
                            newColor.AAA = ratio > 7;
                            newColor.AAALarge = ratio > 4.5;
                            if(newColor[complianceLevel]) {
                                compatibleColors.push(newColor);
                            }
                        }
                    }
                }
                console.warn('Compatible Colors: ' + compatibleColors.length);
                return compatibleColors;
            }

            function displayResults(compatibleColors) {
                const resultsDiv = document.getElementById('compatibleColors');
                resultsDiv.innerHTML = '';
                compatibleColors.forEach(function(color) {
                    var innerElement = document.createElement('div');
                    innerElement.style.backgroundColor = '#' + color.colorCode;
                    innerElement.style.color = color.luminance > 0.5 ? 'black' : 'white';
                    innerElement.innerText = color.colorCode;
                    resultsDiv.appendChild(innerElement);
                });
            }

            function numberToHex(number) {
                if(number < 0 || number > 255) {
                    throw new Error('Number must be between 0 and 255');
                }
                const output = number.toString(16).padStart(2, '0').toUpperCase();
                return output;
            }

            function calculateLuminance(colorCode) {
                const rHex = colorCode.substring(0, 2);
                const gHex = colorCode.substring(2, 4);
                const bHex = colorCode.substring(4, 6);
                var r = parseInt(rHex, 16) / 255;
                var g = parseInt(gHex, 16) / 255;
                var b = parseInt(bHex, 16) / 255;
                r <= 0.03928 ? r = r / 12.92 : r = Math.pow((r + 0.055) / 1.055, 2.4);
                g <= 0.03928 ? g = g / 12.92 : g = Math.pow((g + 0.055) / 1.055, 2.4);
                b <= 0.03928 ? b = b / 12.92 : b = Math.pow((b + 0.055) / 1.055, 2.4);
                const output = r * 0.2126 + g * 0.7152 + b * 0.0722;
                return output;
            }

            //listeners and event handlers
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('mainform-hexCode').addEventListener('submit', function(e) {
                    e.preventDefault();
                });
            })
        </script>
        <style>
            .colorsquare {
                min-height: 10px;
                min-width: 10px;
                max-width: 10px;
                max-height: 10px;
            }

            div {
                max-width: fit-content;
                display: inline-block;
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <form id="mainform-hexCode">
            <input type="text" maxlength="6" minlength="6" placeholder="Enter Color Code" id="inputCode" pattern="[A-Fa-f0-9]{6}" title="Enter Hex value (without #)" />
            <button onclick="submitForm('AAA')" type="button">Check AAA</button>
            <button onclick="submitForm('AA')" type="button">Check AA</button>
        </form>

        <div id="results">
            <h2>Selected Color</h2>
            <div id="selectedColor"></div>
            <h2>Compatible Colors</h2>
            <p class="no-results"><i>Please submit the form above to display compatible colors</i></p>
            <div id="compatibleColors"></div>
        </div>
    </body>
</html>